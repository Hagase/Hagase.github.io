<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">LearnOpenGL-光照 | Shiroha</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "Shirohaの小矛屋";
  mashiro_option.author_name = "小矛屋";
  mashiro_option.site_url = "hagase.github.io";
  mashiro_option.v_appId = "wswNvhpWzQ3DPNl7W2e9u6TW-gzGzoHsz";
  mashiro_option.v_appKey = "CVFjJULlnSe9RxKSEngIk5aR";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/1.png,https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/2.png,https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/3.png,https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/4.png,https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/5.png,https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/6.png,https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/7.png,https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/8.png".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
</head>
</html>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop ">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="hagase.github.io">
          <img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>这里是Shirohaの小矛屋，B站UP主矛盾钢琴师。</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/hagase" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://weibo.com/5641766727/profile" target="_blank" class="social-github" title="sina">
                    <img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/social/sina.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://music.163.com/#/user/home?id=82156482" target="_blank" class="social-github" title="wangyiyun">
                    <img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/social/wangyiyun.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://www.zhihu.com/people/mao-dun-gang-qin-shi-58/activities" target="_blank" class="social-github" title="zhihu">
                    <img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/social/zhihu.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://weibo.com/mashirozx?is_all=1" target="_blank" class="social-github" title="email">
                    <img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/social/email.svg">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">Shirohaの</span>
            <span class="shironeko">小矛屋</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/技术/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/生活/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          生活
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/随想/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          随想
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/转载/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          转载
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/悦读/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          书单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          番组
                        </a>
                      </li>
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags/图集/">
                          <i class="fa fa-photo" aria-hidden="true"></i>
                          图集
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                      <li>
                        <a href="/theme-sakura/">
                          <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                          主题
                        </a>
                      </li>
                    
                      <li>
                        <a href="/lab/">
                          <i class="fa fa-cogs" aria-hidden="true"></i>
                          Lab
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/2.png);" src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/2.png">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      LearnOpenGL-光照</h1>
      <p class="entry-census">
        <span>
          <a href="www.shiroha.cn">
            <img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/custom/avatar.jpg">
          </a>
        </span>
        <span>
          <a href="www.shiroha.cn">Shiroha</a>
        </span>
        <span class="bull">
        ·</span>
        2019-10-7<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <p>@[toc]</p>
<h1 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h1><p>当我们修改顶点或者片段着色器后，灯的位置或颜色也会随之改变，这并不是我们想要的效果.我们不希望灯的颜色在接下来的教程中因光照计算的结果而受到影响，而是希望它能够与其它的<strong>计算分离</strong>.我们希望灯一直保持明亮，不受其它颜色变化的影响（这样它才更像是一个真实的光源）.</p>
<p>为了实现这个目标，我们需要为灯的绘制创建另外的一套着色器，从而能保证它能够在其它光照着色器发生改变的时候不受影响.顶点着色器与我们当前的顶点着色器是一样的，所以你可以直接把现在的顶点着色器用在灯上.灯的片段着色器给灯定义了一个<strong>不变的常量白色</strong>，保证了灯的颜色一直是亮的：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line">out vec4 FragColor;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FragColor = vec4(<span class="number">1.0</span>); <span class="comment">// 将向量的四个分量全部设置为1.0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们想要绘制我们的物体的时候，我们需要使用刚刚定义的光照着色器来绘制箱子（或者可能是其它的物体）.当我们想要绘制灯的时候，我们会使用灯的着色器.在之后的教程里我们会逐步更新这个光照着色器，从而能够慢慢地实现更真实的效果.</p>
<p>使用这个灯立方体的主要目的是为了让我们知道光源在场景中的具体位置。我们通常在场景中定义一个光源的位置，但这只是一个位置，它并没有视觉意义.为了显示真正的灯，我们将表示光源的立方体绘制在与光源相同的位置。我们将使用我们为它新建的片段着色器来绘制它，让它一直处于白色的状态，不受场景中的光照影响.</p>
<p>我们声明一个全局vec3变量来表示光源在场景的世界空间坐标中的位置：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">glm::<span class="function">vec3 <span class="title">lightPos</span><span class="params">(<span class="number">1.2f</span>, <span class="number">1.0f</span>, <span class="number">2.0f</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<p>然后我们把灯位移到这里，然后将它缩小一点，让它不那么明显：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">model = glm::mat4();</span><br><span class="line">model = glm::translate(model, lightPos);</span><br><span class="line">model = glm::scale(model, glm::vec3(<span class="number">0.2f</span>));</span><br></pre></td></tr></table></figure>
<p>绘制灯立方体的代码应该与下面的类似：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">lampShader.use();</span><br><span class="line"><span class="comment">// 设置模型、视图和投影矩阵uniform</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 绘制灯立方体对象</span></span><br><span class="line">glBindVertexArray(lightVAO);</span><br><span class="line">glDrawArrays(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br></pre></td></tr></table></figure>
<h2 id="基础光照"><a href="#基础光照" class="headerlink" title="基础光照"></a>基础光照</h2><p><strong>光的方向向量是光源位置向量与片段位置向量之间的向量差</strong>.你可能记得在变换教程中，我们能够简单地通过让两个向量相减的方式计算向量差.我们同样希望确保所有相关向量最后都转换为单位向量，所以我们把法线和最终的方向向量都进行标准化：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">vec3 norm = normalize(Normal);</span><br><span class="line">vec3 lightDir = normalize(lightPos - FragPos);</span><br></pre></td></tr></table></figure>
<p>下一步，我们对norm和lightDir向量进行点乘，计算光源对当前片段实际的漫发射影响.结果值再乘以光的颜色，得到漫反射分量.两个向量之间的角度越大，漫反射分量就会越小：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> diff = max(dot(norm, lightDir), <span class="number">0.0</span>);</span><br><span class="line">vec3 diffuse = diff * lightColor;</span><br></pre></td></tr></table></figure>
<p>如果两个向量之间的角度<strong>大于90度</strong>，点乘的结果就会变成负数，这样会导致漫反射分量变为<strong>负数</strong>.为此，我们使用max函数返回两个参数之间较大的参数，从而保证漫反射分量不会变成负数.负数颜色的光照是没有定义的，所以最好避免它，除非你是那种古怪的艺术家.</p>
<h2 id="移除法线位移"><a href="#移除法线位移" class="headerlink" title="移除法线位移"></a>移除法线位移</h2><p>现在我们已经把法向量从顶点着色器传到了片段着色器.可是，目前片段着色器里的计算都是在<strong>世界空间坐标</strong>中进行的.所以，我们是不是应该把法向量也转换为世界空间坐标？基本正确，但是这不是简单地把它乘以一个模型矩阵就能搞定的.</p>
<p>首先，法向量只是一个方向向量，不能表达空间中的特定位置.同时，法向量<strong>没有齐次坐标</strong>（顶点位置中的w分量）.这意味着，位移不应该影响到法向量.因此，如果我们打算把法向量乘以一个模型矩阵，我们就要从矩阵中移除位移部分，只选用模型矩阵<strong>左上角3×3</strong>的矩阵（注意，我们也可以把法向量的w分量设置为0，再乘以4×4矩阵；这同样可以移除位移）.对于法向量，我们只希望对它实施缩放和旋转变换.</p>
<p>其次，如果模型矩阵执行了不等比缩放，顶点的改变会导致法向量不再垂直于表面了.因此，我们不能用这样的模型矩阵来变换法向量.下面的图展示了应用了不等比缩放的模型矩阵对法向量的影响：<br><img src="https://img-blog.csdnimg.cn/20190923142746292.png" alt="在这里插入图片描述"><br>修复这个行为的诀窍是使用一个为法向量专门定制的模型矩阵.这个矩阵称之为<strong>法线矩阵</strong>(Normal Matrix)，它使用了一些线性代数的操作来移除对法向量错误缩放的影响.</p>
<p>法线矩阵被定义为「模型矩阵左上角的逆矩阵的转置矩阵」.真是拗口，如果你不明白这是什么意思，别担心，我们还没有讨论逆矩阵(Inverse Matrix)和转置矩阵(Transpose Matrix).注意，大部分的资源都会将法线矩阵定义为应用到模型-观察矩阵(Model-view Matrix)上的操作，但是由于我们只在世界空间中进行操作（不是在观察空间），我们只使用模型矩阵.</p>
<p>在顶点着色器中，我们可以使用inverse和transpose函数自己生成这个法线矩阵，这两个函数对所有类型矩阵都有效.注意我们还要把被处理过的矩阵强制转换为3×3矩阵，来保证它失去了位移属性以及能够乘以vec3的法向量.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Normal = mat3(transpose(inverse(model))) * aNormal;</span><br></pre></td></tr></table></figure>
<p>在漫反射光照部分，光照表现并没有问题，这是因为我们没有对物体本身执行任何缩放操作，所以并不是必须要使用一个法线矩阵，仅仅让模型矩阵乘以法线也可以.可是，如果你进行了不等比缩放，使用法线矩阵去乘以法向量就是必不可少的了.</p>
<blockquote>
<p>即使是对于着色器来说，逆矩阵也是一个开销比较大的运算，因此，只要可能就应该避免在着色器中进行逆矩阵运算，它们必须为你场景中的每个顶点都进行这样的处理.用作学习目这样做是可以的，但是对于一个对效率有要求的应用来说，在绘制之前你最好用CPU计算出法线矩阵，然后通过uniform把值传递给着色器（像模型矩阵一样）.</p>
</blockquote>
<h3 id="镜面分量"><a href="#镜面分量" class="headerlink" title="镜面分量"></a>镜面分量</h3><p>现在我们已经获得所有需要的变量，可以计算高光强度了.首先，我们定义一个<strong>镜面强度</strong>(Specular Intensity)变量，给镜面高光一个中等亮度颜色，让它不要产生过度的影响.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> specularStrength = <span class="number">0.5</span>;</span><br></pre></td></tr></table></figure>
<p>下一步，我们计算视线方向向量，和对应的沿着法线轴的反射向量：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">vec3 viewDir = normalize(viewPos - FragPos);</span><br><span class="line">vec3 reflectDir = reflect(-lightDir, norm);</span><br></pre></td></tr></table></figure>
<p>需要注意的是我们对lightDir向量进行了取反.reflect函数要求第一个向量是从光源指向片段位置的向量，但是lightDir当前正好相反，是从片段指向光源（由先前我们计算lightDir向量时，减法的顺序决定）.为了保证我们得到正确的reflect向量，我们通过对lightDir向量取反来获得相反的方向.第二个参数要求是一个法向量，所以我们提供的是已标准化的norm向量.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> spec = <span class="built_in">pow</span>(max(dot(viewDir, reflectDir), <span class="number">0.0</span>), <span class="number">32</span>);</span><br><span class="line">vec3 specular = specularStrength * spec * lightColor;</span><br></pre></td></tr></table></figure>
<p>我们先计算视线方向与反射方向的点乘（并确保它不是负值），然后取它的32次幂。这个32是高光的<strong>反光度</strong>(Shininess).一个物体的反光度越高，反射光的能力越强，散射得越少，高光点就会越小.在下面的图片里，你会看到不同反光度的视觉效果影响：<br><img src="https://img-blog.csdnimg.cn/20190923143946217.png" alt="在这里插入图片描述"><br>剩下的最后一件事情是把它加到环境光分量和漫反射分量里，再用结果乘以物体的颜色：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vec3 result = (ambient + diffuse + specular) * objectColor;</span><br><span class="line">FragColor = vec4(result, 1.0);</span><br></pre></td></tr></table></figure></p>
<h1 id="材质"><a href="#材质" class="headerlink" title="材质"></a>材质</h1><p>当描述一个物体的时候，我们可以用这三个分量来定义一个材质颜色(Material Color)：环境光照(Ambient Lighting)、漫反射光照(Diffuse Lighting)和镜面光照(Specular Lighting).通过为每个分量指定一个颜色，我们就能够对物体的颜色输出有着精细的控制了.现在，我们再添加反光度(Shininess)这个分量到上述的三个颜色中，这就有我们需要的所有材质属性了：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Material</span> &#123;</span></span><br><span class="line">    vec3 ambient;</span><br><span class="line">    vec3 diffuse;</span><br><span class="line">    vec3 specular;</span><br><span class="line">    <span class="keyword">float</span> shininess;</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line">uniform Material material;</span><br></pre></td></tr></table></figure>
<p>ambient材质向量定义了在环境光照下这个物体反射得是什么颜色，通常这是和物体颜色相同的颜色.diffuse材质向量定义了在漫反射光照下物体的颜色.（和环境光照一样）漫反射颜色也要设置为我们需要的物体颜色.specular材质向量设置的是镜面光照对物体的颜色影响（或者甚至可能反射一个物体特定的镜面高光颜色）.最后，shininess影响镜面高光的散射/半径.</p>
<p>这四个元素定义了一个物体的材质，通过它们我们能够模拟很多现实世界中的材质.devernay.free.fr上的一个表格展示了几种材质属性，它们模拟了现实世界中的真实材质.下面的图片展示了几种现实世界的材质对我们的立方体的影响：<br><img src="https://img-blog.csdnimg.cn/20190923175033216.png" alt="在这里插入图片描述"></p>
<h2 id="设置材质"><a href="#设置材质" class="headerlink" title="设置材质"></a>设置材质</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    <span class="comment">// 环境光</span></span><br><span class="line">    vec3 ambient = lightColor * material.ambient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 漫反射 </span></span><br><span class="line">    vec3 norm = normalize(Normal);</span><br><span class="line">    vec3 lightDir = normalize(lightPos - FragPos);</span><br><span class="line">    <span class="keyword">float</span> diff = max(dot(norm, lightDir), <span class="number">0.0</span>);</span><br><span class="line">    vec3 diffuse = lightColor * (diff * material.diffuse);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 镜面光</span></span><br><span class="line">    vec3 viewDir = normalize(viewPos - FragPos);</span><br><span class="line">    vec3 reflectDir = reflect(-lightDir, norm);  </span><br><span class="line">    <span class="keyword">float</span> spec = <span class="built_in">pow</span>(max(dot(viewDir, reflectDir), <span class="number">0.0</span>), material.shininess);</span><br><span class="line">    vec3 specular = lightColor * (spec * material.specular);  </span><br><span class="line"></span><br><span class="line">    vec3 result = ambient + diffuse + specular;</span><br><span class="line">    FragColor = vec4(result, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们现在可以在程序中设置适当的uniform，对物体设置材质了.GLSL中的结构体在设置uniform时并没有什么特别之处.结构体只是作为uniform变量的一个封装，所以如果想填充这个结构体的话，我们仍需要对每个单独的uniform进行设置，但这次要带上结构体名的前缀：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">lightingShader.setVec3(<span class="string">"material.ambient"</span>,  <span class="number">1.0f</span>, <span class="number">0.5f</span>, <span class="number">0.31f</span>);</span><br><span class="line">lightingShader.setVec3(<span class="string">"material.diffuse"</span>,  <span class="number">1.0f</span>, <span class="number">0.5f</span>, <span class="number">0.31f</span>);</span><br><span class="line">lightingShader.setVec3(<span class="string">"material.specular"</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>);</span><br><span class="line">lightingShader.setFloat(<span class="string">"material.shininess"</span>, <span class="number">32.0f</span>);</span><br></pre></td></tr></table></figure>
<h2 id="光的属性"><a href="#光的属性" class="headerlink" title="光的属性"></a>光的属性</h2><p>物体过亮的原因是环境光、漫反射和镜面光这三个颜色对任何一个光源都会去全力反射.光源对环境光、漫反射和镜面光分量也具有着不同的强度。前面的教程，我们通过使用一个强度值改变环境光和镜面光强度的方式解决了这个问题.我们想做一个类似的系统，但是这次是要为每个光照分量都指定一个强度向量.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">vec3 ambient = vec3(<span class="number">0.1</span>) * material.ambient;</span><br></pre></td></tr></table></figure>
<p>一个光源对它的ambient、diffuse和specular光照有着不同的强度.<strong>环境光</strong>照通常会设置为一个<strong>比较低</strong>的强度，因为我们不希望环境光颜色太过显眼.光源的<strong>漫反射</strong>分量通常设置为<strong>光所具有的颜色</strong>，通常是一个比较明亮的白色.<strong>镜面光</strong>分量通常会保持为<strong>vec3(1.0)</strong>，以最大强度发光.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">lightingShader.setVec3(<span class="string">"light.ambient"</span>,  <span class="number">0.2f</span>, <span class="number">0.2f</span>, <span class="number">0.2f</span>);</span><br><span class="line">lightingShader.setVec3(<span class="string">"light.diffuse"</span>,  <span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>); <span class="comment">// 将光照调暗了一些以搭配场景</span></span><br><span class="line">lightingShader.setVec3(<span class="string">"light.specular"</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span></span><br></pre></td></tr></table></figure>
<h2 id="不同的光源颜色"><a href="#不同的光源颜色" class="headerlink" title="不同的光源颜色"></a>不同的光源颜色</h2><p>我们可以利用sin和glfwGetTime函数改变光源的环境光和漫反射颜色，从而很容易地让光源的颜色随着时间变化：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">glm::vec3 lightColor;</span><br><span class="line">lightColor.x = <span class="built_in">sin</span>(glfwGetTime() * <span class="number">2.0f</span>);</span><br><span class="line">lightColor.y = <span class="built_in">sin</span>(glfwGetTime() * <span class="number">0.7f</span>);</span><br><span class="line">lightColor.z = <span class="built_in">sin</span>(glfwGetTime() * <span class="number">1.3f</span>);</span><br><span class="line"></span><br><span class="line">glm::vec3 diffuseColor = lightColor   * glm::vec3(<span class="number">0.5f</span>); <span class="comment">// 降低影响</span></span><br><span class="line">glm::vec3 ambientColor = diffuseColor * glm::vec3(<span class="number">0.2f</span>); <span class="comment">// 很低的影响</span></span><br><span class="line"></span><br><span class="line">lightingShader.setVec3(<span class="string">"light.ambient"</span>, ambientColor);</span><br><span class="line">lightingShader.setVec3(<span class="string">"light.diffuse"</span>, diffuseColor);</span><br></pre></td></tr></table></figure>
<h1 id="光照贴图"><a href="#光照贴图" class="headerlink" title="光照贴图"></a>光照贴图</h1><p>在上一节中，我们将整个物体的材质定义为一个整体，但现实世界中的物体通常并不只包含有一种材质，而是由多种材质所组成.想想一辆汽车：它的外壳非常有光泽，车窗会部分反射周围的环境，轮胎不会那么有光泽，所以它没有镜面高光，轮毂非常闪亮（如果你洗车了的话）.汽车同样会有漫反射和环境光颜色，它们在整个物体上也不会是一样的，汽车有着许多种不同的环境光/漫反射颜色.总之，这样的物体在不同的部件上都有不同的材质属性.</p>
<p>所以，上一节中的那个材质系统是肯定不够的，它只是一个最简单的模型，所以我们需要拓展之前的系统，引入漫反射和镜面光贴图(Map).这允许我们对物体的漫反射分量（以及间接地对环境光分量，它们几乎总是一样的）和镜面光分量有着更精确的控制.</p>
<h2 id="漫反射贴图"><a href="#漫反射贴图" class="headerlink" title="漫反射贴图"></a>漫反射贴图</h2><blockquote>
<p>注意sampler2D是所谓的<strong>不透明类型</strong>(Opaque Type)，也就是说我们不能将它实例化，只能通过<strong>uniform</strong>来定义它.如果我们使用除uniform以外的方法（比如函数的参数）实例化这个结构体，GLSL会抛出一些奇怪的错误.这同样也适用于任何封装了不透明类型的结构体.</p>
</blockquote>
<p>我们也移除了<strong>环境光材质</strong>颜色向量，因为环境光颜色在几乎所有情况下都<strong>等于</strong>漫反射颜色，所以我们不需要将它们分开储存：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Material</span> &#123;</span></span><br><span class="line">    sampler2D diffuse;</span><br><span class="line">    vec3      specular;</span><br><span class="line">    <span class="keyword">float</span>     shininess;</span><br><span class="line">&#125;; </span><br><span class="line">...</span><br><span class="line">in vec2 TexCoords;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20190923185009166.png" alt="在这里插入图片描述"></p>
<h1 id="镜面光贴图"><a href="#镜面光贴图" class="headerlink" title="镜面光贴图"></a>镜面光贴图</h1><p>你可能会注意到，镜面高光看起来有些奇怪，因为我们的物体大部分都是木头，我们知道木头不应该有这么强的镜面高光的。我们可以将物体的镜面光材质设置为vec3(0.0)来解决这个问题，但这也意味着箱子钢制的边框将不再能够显示镜面高光了，我们知道钢铁应该是有一些镜面高光的.所以，我们想要让物体的某些部分以不同的强度显示镜面高光.这个问题看起来和漫反射贴图非常相似.</p>
<p>我们同样可以使用一个专门用于镜面高光的纹理贴图.这也就意味着我们需要生成一个黑白的（如果你想得话也可以是彩色的）纹理，来定义物体每部分的镜面光强度。下面是一个镜面光贴图(Specular Map)的例子：<br><img src="https://img-blog.csdnimg.cn/20190923185107744.png" alt="在这里插入图片描述"><br>镜面高光的强度可以通过图像每个像素的<strong>亮度</strong>来获取.镜面光贴图上的每个像素都可以由一个颜色向量来表示，比如说黑色代表颜色向量vec3(0.0)，灰色代表颜色向量vec3(0.5).在片段着色器中，我们接下来会取样对应的<strong>颜色值</strong>并将它<strong>乘以</strong>光源的<strong>镜面强度</strong>.<strong>一个像素越「白」，乘积就会越大，物体的镜面光分量就会越亮.</strong></p>
<p>由于箱子大部分都由木头所组成，而且木头材质应该没有镜面高光，所以漫反射纹理的整个木头部分全部都转换成了黑色.箱子钢制边框的镜面光强度是有细微变化的，钢铁本身会比较容易受到镜面高光的影响，而裂缝则不会.</p>
<h1 id="采样镜面光贴图"><a href="#采样镜面光贴图" class="headerlink" title="采样镜面光贴图"></a>采样镜面光贴图</h1><p>由于我们正在同一个片段着色器中使用另一个纹理采样器，我们必须要对镜面光贴图使用一个<strong>不同</strong>的纹理单元（GL_TEXTURE1），所以我们在渲染之前先把它绑定到合适的纹理单元上：<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">lightingShader.setInt(<span class="string">"material.specular"</span>, <span class="number">1</span>);</span><br><span class="line">...</span><br><span class="line">glActiveTexture(GL_TEXTURE1);</span><br><span class="line">glBindTexture(GL_TEXTURE_2D, specularMap);</span><br></pre></td></tr></table></figure></p>
<p>接下来更新片段着色器的材质属性，让其接受一个sampler2D而不是vec3作为镜面光分量：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Material</span> &#123;</span></span><br><span class="line">    sampler2D diffuse;</span><br><span class="line">    sampler2D specular;</span><br><span class="line">    <span class="keyword">float</span>     shininess;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>最后我们希望采样镜面光贴图，来获取片段所对应的镜面光强度：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">vec3 ambient  = light.ambient  * vec3(texture(material.diffuse, TexCoords));</span><br><span class="line">vec3 diffuse  = light.diffuse  * diff * vec3(texture(material.diffuse, TexCoords));  </span><br><span class="line">vec3 specular = light.specular * spec * vec3(texture(material.specular, TexCoords));</span><br><span class="line">FragColor = vec4(ambient + diffuse + specular, <span class="number">1.0</span>);</span><br></pre></td></tr></table></figure>
<p>通过使用镜面光贴图我们可以可以对物体设置大量的细节，比如物体的哪些部分需要有闪闪发光的属性，我们甚至可以设置它们对应的强度.镜面光贴图能够在漫反射贴图之上给予我们更高一层的控制.</p>
<h1 id="投光物"><a href="#投光物" class="headerlink" title="投光物"></a>投光物</h1><h2 id="平行光"><a href="#平行光" class="headerlink" title="平行光"></a>平行光</h2><p>当我们使用一个假设光源处于无限远处的模型时，它就被称为定向光，因为它的所有光线都有着相同的方向，它与光源的位置是没有关系的.</p>
<p>我们可以定义一个光线方向向量而不是位置向量来模拟一个定向光.着色器的计算基本保持不变，但这次我们将直接使用光的direction向量而不是通过direction来计算lightDir向量.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Light</span> &#123;</span></span><br><span class="line">    <span class="comment">// vec3 position; // 使用定向光就不再需要了</span></span><br><span class="line">    vec3 direction;</span><br><span class="line"></span><br><span class="line">    vec3 ambient;</span><br><span class="line">    vec3 diffuse;</span><br><span class="line">    vec3 specular;</span><br><span class="line">&#125;;</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  vec3 lightDir = normalize(-light.direction);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意我们首先对light.direction向量取反.我们目前使用的光照计算需求一个从片段至光源的光线方向，但人们更习惯定义定向光为一个从光源出发的全局方向。所以我们需要对全局光照方向向量取反来改变它的方向，它现在是一个指向光源的方向向量了.而且，记得对向量进行标准化，假设输入向量为一个单位向量是很不明智的.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    glm::mat4 model;</span><br><span class="line">    model = glm::translate(model, cubePositions[i]);</span><br><span class="line">    <span class="keyword">float</span> angle = <span class="number">20.0f</span> * i;</span><br><span class="line">    model = glm::rotate(model, glm::radians(angle), glm::vec3(<span class="number">1.0f</span>, <span class="number">0.3f</span>, <span class="number">0.5f</span>));</span><br><span class="line">    lightingShader.setMat4(<span class="string">"model"</span>, model);</span><br><span class="line"></span><br><span class="line">    glDrawArrays(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时，不要忘记定义光源的方向（注意我们将方向定义为从光源出发的方向，你可以很容易看到光的方向朝下）.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">lightingShader.setVec3(<span class="string">"light.direction"</span>, <span class="number">-0.2f</span>, <span class="number">-1.0f</span>, <span class="number">-0.3f</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>我们一直将光的位置和位置向量定义为vec3，但一些人会喜欢将所有的向量都定义为vec4.当我们将位置向量定义为一个vec4时，很重要的一点是要将w分量设置为1.0，这样变换和投影才能正确应用。然而，当我们定义一个方向向量为vec4的时候，我们不想让位移有任何的效果（因为它仅仅代表的是方向），所以我们将w分量设置为0.0.<br>方向向量就会像这样来表示：vec4(0.2f, 1.0f, 0.3f, <strong>0.0f</strong>)。这也可以作为一个快速检测光照类型的工具：你可以检测w分量是否等于1.0，来检测它是否是光的位置向量；<strong>w分量等于0.0，则它是光的方向向量</strong>，这样就能根据这个来调整光照计算了：<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(lightVector.w == <span class="number">0.0</span>) <span class="comment">// 注意浮点数据类型的误差</span></span><br><span class="line">  <span class="comment">// 执行定向光照计算</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(lightVector.w == <span class="number">1.0</span>)</span><br><span class="line">  <span class="comment">// 根据光源的位置做光照计算（与上一节一样）</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="点光源"><a href="#点光源" class="headerlink" title="点光源"></a>点光源</h2><p><strong>定向光</strong>对于照亮整个场景的<strong>全局光源</strong>是非常棒的，但除了定向光之外我们也需要一些分散在场景中的<strong>点光源</strong>(Point Light).点光源是处于世界中某一个位置的光源，它会朝着所有方向发光，但光线会随着距离逐渐衰减.想象作为投光物的灯泡和火把，它们都是点光源.</p>
<p>然而，我们定义的光源模拟的是永远不会衰减的光线，这看起来像是光源亮度非常的强.在大部分的3D模拟中，我们都希望模拟的光源仅照亮光源附近的区域而不是整个场景。</p>
<p>如果你将10个箱子加入到上一节光照场景中，你会注意到在最后面的箱子和在灯面前的箱子都以相同的强度被照亮，并没有定义一个公式来将光随距离衰减.我们希望在后排的箱子与前排的箱子相比仅仅是被轻微地照亮.</p>
<h2 id="衰减"><a href="#衰减" class="headerlink" title="衰减"></a>衰减</h2><p>下面这个公式根据片段距光源的距离计算了衰减值，之后我们会将它乘以光的强度向量：<br><img src="https://img-blog.csdnimg.cn/20190923193820577.png" alt="在这里插入图片描述"><br>在这里d代表了片段距光源的距离。接下来为了计算衰减值，我们定义3个（可配置的）项：常数项Kc、一次项Kl和二次项Kq.</p>
<ul>
<li>常数项通常保持为1.0，它的主要作用是保证分母永远不会比1小，否则的话在某些距离上它反而会增加强度，这肯定不是我们想要的效果.</li>
<li>一次项会与距离值相乘，以线性的方式减少强度.</li>
<li>二次项会与距离的平方相乘，让光源以二次递减的方式减少强度.二次项在距离比较小的时候影响会比一次项小很多，但当距离值比较大的时候它就会比一次项更大了.</li>
</ul>
<p>由于二次项的存在，光线会在<strong>大部分</strong>时候以<strong>线性</strong>的方式衰退，直到距离变得足够大，让二次项超过一次项，光的强度会以<strong>更快的速度</strong>下降。这样的结果就是，光在近距离时亮度很高，但随着距离变远亮度迅速降低，最后会以更慢的速度减少亮度.下面这张图显示了在100的距离内衰减的效果：<br><img src="https://img-blog.csdnimg.cn/20190923194849160.png" alt="在这里插入图片描述"></p>
<h2 id="选择正确的值"><a href="#选择正确的值" class="headerlink" title="选择正确的值"></a>选择正确的值</h2><p>正确地设定它们的值取决于很多因素：环境、希望光覆盖的距离、光的类型等.在大多数情况下，这都是经验的问题，以及适量的调整.下面这个表格显示了模拟一个（大概）真实的，覆盖特定半径（距离）的光源时，这些项可能取的一些值.第一列指定的是在给定的三项时光所能覆盖的距离.这些值是大多数光源很好的起始点，它们由Ogre3D的Wiki所提供：<br><img src="https://img-blog.csdnimg.cn/2019092319502232.png" alt="在这里插入图片描述"><br>常数项Kc在所有的情况下都是1.0.一次项Kl为了覆盖更远的距离通常都很小，二次项Kq甚至更小.尝试对这些值进行实验，看看它们在你的实现中有什么效果.在我们的环境中，32到100的距离对大多数的光源都足够了.</p>
<h2 id="实现衰减"><a href="#实现衰减" class="headerlink" title="实现衰减"></a>实现衰减</h2><p>为了实现衰减，在片段着色器中我们还需要三个额外的值：也就是公式中的常数项、一次项和二次项.它们最好储存在之前定义的Light结构体中.注意我们使用上一节中计算lightDir的方法，而不是上面定向光部分的.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Light</span> &#123;</span></span><br><span class="line">    vec3 position;  </span><br><span class="line"></span><br><span class="line">    vec3 ambient;</span><br><span class="line">    vec3 diffuse;</span><br><span class="line">    vec3 specular;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> constant;</span><br><span class="line">    <span class="keyword">float</span> linear;</span><br><span class="line">    <span class="keyword">float</span> quadratic;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后我们将在OpenGL中设置这些项：我们希望光源能够覆盖50的距离，所以我们会使用表格中对应的常数项、一次项和二次项：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">lightingShader.setFloat(<span class="string">"light.constant"</span>,  <span class="number">1.0f</span>);</span><br><span class="line">lightingShader.setFloat(<span class="string">"light.linear"</span>,    <span class="number">0.09f</span>);</span><br><span class="line">lightingShader.setFloat(<span class="string">"light.quadratic"</span>, <span class="number">0.032f</span>);</span><br></pre></td></tr></table></figure>
<p>在片段着色器中实现衰减还是比较直接的：我们根据公式计算衰减值，之后再分别乘以环境光、漫反射和镜面光分量.</p>
<p>我们仍需要公式中距光源的距离，还记得我们是怎么计算一个向量的长度的吗？我们可以通过获取片段和光源之间的向量差，并获取结果向量的长度作为距离项.我们可以使用GLSL内建的length函数来完成这一点：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> distance    = length(light.position - FragPos);</span><br><span class="line"><span class="keyword">float</span> attenuation = <span class="number">1.0</span> / (light.constant + light.linear * distance + </span><br><span class="line">                light.quadratic * (distance * distance));</span><br><span class="line">ambient  *= attenuation; </span><br><span class="line">diffuse  *= attenuation;</span><br><span class="line">specular *= attenuation;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20190923195509455.png" alt="在这里插入图片描述"><br>可以看到，只有前排的箱子被照亮的，距离最近的箱子是最亮的.后排的箱子一点都没有照亮，因为它们离光源实在是太远了.</p>
<h2 id="聚光"><a href="#聚光" class="headerlink" title="聚光"></a>聚光</h2><p>聚光(Spotlight)是位于环境中某个位置的光源，它只朝一个特定方向而不是所有方向照射光线.这样的结果就是只有在聚光方向的特定半径内的物体才会被照亮，其它的物体都会保持黑暗。聚光很好的例子就是路灯或手电筒.</p>
<p>OpenGL中聚光是用<strong>一个世界空间位置、一个方向和一个切光角(Cutoff Angle)</strong>来表示的，<strong>切光角指定了聚光的半径</strong>（译注：是圆锥的半径不是距光源距离那个半径）.对于每个片段，我们会计算片段是否位于聚光的切光方向之间（也就是在锥形内），如果是的话，我们就会相应地照亮片段。下面这张图会让你明白聚光是如何工作的：<br><img src="https://img-blog.csdnimg.cn/2019092319581230.png" alt="在这里插入图片描述"></p>
<ul>
<li>LightDir：从片段指向光源的向量.</li>
<li>SpotDir：聚光所指向的方向.</li>
<li>Phiϕ：指定了聚光半径的切光角.落在这个角度之外的物体都不会被这个聚光所照亮.</li>
<li>Thetaθ：LightDir向量和SpotDir向量之间的夹角.在聚光内部的话θ值应该比ϕ值小.</li>
</ul>
<p>所以我们要做的就是计算<strong>LightDir</strong>向量和<strong>SpotDir</strong>向量之间的点积（还记得它会返回两个单位向量夹角的余弦值吗？），并将它与切光角ϕ值对比.你现在应该了解聚光究竟是什么了，下面我们将以手电筒的形式创建一个聚光.</p>
<h2 id="手电筒"><a href="#手电筒" class="headerlink" title="手电筒"></a>手电筒</h2><p>手电筒(Flashlight)是一个位于观察者位置的聚光，通常它都会瞄准玩家视角的正前方.基本上说，手电筒就是普通的聚光，但它的位置和方向会随着玩家的位置和朝向不断更新.</p>
<p>所以，在片段着色器中我们需要的值有聚光的位置向量（来计算光的方向向量）、聚光的方向向量和一个切光角.我们可以将它们储存在Light结构体中：<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Light</span> &#123;</span></span><br><span class="line">    vec3  position;</span><br><span class="line">    vec3  direction;</span><br><span class="line">    <span class="keyword">float</span> cutOff;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>接下来我们将合适的值传到着色器中：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">lightingShader.setVec3(<span class="string">"light.position"</span>,  camera.Position);</span><br><span class="line">lightingShader.setVec3(<span class="string">"light.direction"</span>, camera.Front);</span><br><span class="line">lightingShader.setFloat(<span class="string">"light.cutOff"</span>,   glm::<span class="built_in">cos</span>(glm::radians(<span class="number">12.5f</span>)));</span><br></pre></td></tr></table></figure>
<p>你可以看到，我们并没有给切光角设置一个角度值，反而是用角度值计算了一个余弦值，将余弦结果传递到片段着色器中.这样做的原因是在片段着色器中，我们会计算LightDir和SpotDir向量的点积，这个点积返回的将是一个余弦值而不是角度值，所以我们不能直接使用角度值和余弦值进行比较.为了获取角度值我们需要计算点积结果的反余弦，这是一个开销很大的计算.所以为了<strong>节约一点性能开销</strong>，我们将会计算切光角对应的余弦值，并将它的结果传入片段着色器中.由于这两个角度现在都由余弦角来表示了，我们可以直接对它们进行比较而不用进行任何开销高昂的计算.</p>
<p>接下来就是计算θ值，并将它和切光角ϕ对比，来决定是否在聚光的内部：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> theta = dot(lightDir, normalize(-light.direction));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(theta &gt; light.cutOff) </span><br><span class="line">&#123;       </span><br><span class="line">  <span class="comment">// 执行光照计算</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>  <span class="comment">// 否则，使用环境光，让场景在聚光之外时不至于完全黑暗</span></span><br><span class="line">  color = vec4(light.ambient * vec3(texture(material.diffuse, TexCoords)), <span class="number">1.0</span>);</span><br></pre></td></tr></table></figure>
<p>我们首先计算了lightDir和取反的direction向量（取反的是因为我们想让向量指向光源而不是从光源出发）之间的点积.记住要对所有的相关向量标准化.</p>
<p><img src="https://img-blog.csdnimg.cn/20190923204704814.png" alt="在这里插入图片描述"><br>这仍看起来有些假，主要是因为聚光有一圈硬边.当一个片段遇到聚光圆锥的边缘时，它会完全变暗，没有一点平滑的过渡.一个真实的聚光将会在边缘处逐渐减少亮度.</p>
<h2 id="平滑-软化边缘"><a href="#平滑-软化边缘" class="headerlink" title="平滑/软化边缘"></a>平滑/软化边缘</h2><p>为了创建一种看起来边缘平滑的聚光，我们需要模拟聚光有一个<strong>内圆锥</strong>(Inner Cone)和一个<strong>外圆锥</strong>(Outer Cone).我们可以将内圆锥设置为上一部分中的那个圆锥，但我们也需要一个外圆锥，来让光从内圆锥逐渐减暗，直到外圆锥的边界.</p>
<p>为了创建一个外圆锥，我们只需要再定义一个余弦值来代表<strong>聚光方向向量和外圆锥向量（等于它的半径）的夹角</strong>.然后，<strong>如果一个片段处于内外圆锥之间，将会给它计算出一个0.0到1.0之间的强度值</strong>.如果片段在内圆锥之内，它的强度就是1.0，如果在外圆锥之外强度值就是0.0.</p>
<p>我们可以用下面这个公式来计算这个值：<br><img src="https://img-blog.csdnimg.cn/20190923204942182.png" alt="在这里插入图片描述"><br>这里ϵ(Epsilon)是内（ϕ）和外圆锥（γ）之间的余弦值差（ϵ=ϕ−γ）.最终的I值就是在当前片段<strong>聚光的强度</strong>.</p>
<p>很难去表现这个公式是怎么工作的，所以我们用一些实例值来看看：<br><img src="https://img-blog.csdnimg.cn/20190923205049402.png" alt="在这里插入图片描述"><br>你可以看到，我们基本是在内外余弦值之间根据θ插值.如果你仍不明白发生了什么，不必担心，只需要记住这个公式就好了，在你更聪明的时候再回来看看。</p>
<p>我们现在有了一个在聚光外是负的，在内圆锥内大于1.0的，在边缘处于两者之间的强度值了.如果我们正确地约束(Clamp)这个值，在片段着色器中就不再需要if-else了，我们能够使用计算出来的强度值直接乘以光照分量：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> theta     = dot(lightDir, normalize(-light.direction));</span><br><span class="line"><span class="keyword">float</span> epsilon   = light.cutOff - light.outerCutOff;</span><br><span class="line"><span class="keyword">float</span> intensity = clamp((theta - light.outerCutOff) / epsilon, <span class="number">0.0</span>, <span class="number">1.0</span>);    </span><br><span class="line">...</span><br><span class="line"><span class="comment">// 将不对环境光做出影响，让它总是能有一点光</span></span><br><span class="line">diffuse  *= intensity;</span><br><span class="line">specular *= intensity;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>注意我们使用了clamp函数，它把第一个参数约束(Clamp)在了0.0到1.0之间.这保证强度值不会在[0, 1]区间之外.<br><img src="https://img-blog.csdnimg.cn/20190923205708117.png" alt="在这里插入图片描述"></p>
<h1 id="多光源"><a href="#多光源" class="headerlink" title="多光源"></a>多光源</h1><p>为了在场景中使用多个光源，我们希望将光照计算封装到GLSL函数中.这样做的原因是，每一种光源都需要一种不同的计算方法，而一旦我们想对多个光源进行光照计算时，代码很快就会变得非常复杂.如果我们只在main函数中进行所有的这些计算，代码很快就会变得难以理解.</p>
<p>当我们在场景中使用多个光源时，通常使用以下方法：我们需要有一个单独的颜色向量代表片段的输出颜色.对于每一个光源，它对片段的贡献颜色将会加到片段的输出颜色向量上.所以场景中的每个光源都会计算它们各自对片段的影响，并结合为一个最终的输出颜色.大体的结构会像是这样：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">out vec4 FragColor;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// 定义一个输出颜色值</span></span><br><span class="line">  vec3 output;</span><br><span class="line">  <span class="comment">// 将定向光的贡献加到输出中</span></span><br><span class="line">  output += someFunctionToCalculateDirectionalLight();</span><br><span class="line">  <span class="comment">// 对所有的点光源也做相同的事情</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nr_of_point_lights; i++)</span><br><span class="line">    output += someFunctionToCalculatePointLight();</span><br><span class="line">  <span class="comment">// 也加上其它的光源（比如聚光）</span></span><br><span class="line">  output += someFunctionToCalculateSpotLight();</span><br><span class="line"></span><br><span class="line">  FragColor = vec4(output, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际的代码对每一种实现都可能不同，但大体的结构都是差不多的.我们定义了几个函数，用来计算每个光源的影响，并将最终的结果颜色加到输出颜色向量上.例如，如果两个光源都很靠近一个片段，那么它们所结合的贡献将会形成一个比单个光源照亮时更加明亮的片段.</p>
<h2 id="定向光"><a href="#定向光" class="headerlink" title="定向光"></a>定向光</h2><p>我们需要在片段着色器中定义一个函数来计算定向光对相应片段的贡献：它接受一些参数并<strong>计算一个定向光照颜色</strong>.</p>
<p>首先，我们需要定义一个定向光源最少所需要的变量.我们可以将这些变量储存在一个叫做DirLight的结构体中，并将它定义为一个uniform.需要的变量在上一节中都介绍过：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DirLight</span> &#123;</span></span><br><span class="line">    vec3 direction;</span><br><span class="line"></span><br><span class="line">    vec3 ambient;</span><br><span class="line">    vec3 diffuse;</span><br><span class="line">    vec3 specular;</span><br><span class="line">&#125;;  </span><br><span class="line">uniform DirLight dirLight;</span><br></pre></td></tr></table></figure>
<p>接下来我们可以将dirLight传入一个有着一下原型的函数:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">vec3 <span class="title">CalcDirLight</span><span class="params">(DirLight light, vec3 normal, vec3 viewDir)</span></span>;</span><br></pre></td></tr></table></figure>
<p>你可以看到，这个函数需要一个DirLight结构体和其它两个向量来进行计算.<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">vec3 <span class="title">CalcDirLight</span><span class="params">(DirLight light, vec3 normal, vec3 viewDir)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vec3 lightDir = normalize(-light.direction);</span><br><span class="line">    <span class="comment">// 漫反射着色</span></span><br><span class="line">    <span class="keyword">float</span> diff = max(dot(normal, lightDir), <span class="number">0.0</span>);</span><br><span class="line">    <span class="comment">// 镜面光着色</span></span><br><span class="line">    vec3 reflectDir = reflect(-lightDir, normal);</span><br><span class="line">    <span class="keyword">float</span> spec = <span class="built_in">pow</span>(max(dot(viewDir, reflectDir), <span class="number">0.0</span>), material.shininess);</span><br><span class="line">    <span class="comment">// 合并结果</span></span><br><span class="line">    vec3 ambient  = light.ambient  * vec3(texture(material.diffuse, TexCoords));</span><br><span class="line">    vec3 diffuse  = light.diffuse  * diff * vec3(texture(material.diffuse, TexCoords));</span><br><span class="line">    vec3 specular = light.specular * spec * vec3(texture(material.specular, TexCoords));</span><br><span class="line">    <span class="keyword">return</span> (ambient + diffuse + specular);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="点光源-1"><a href="#点光源-1" class="headerlink" title="点光源"></a>点光源</h2><p>和定向光一样，我们也希望定义一个用于计算点光源对相应片段贡献，以及衰减的函数.同样，我们定义一个包含了点光源所需所有变量的结构体：<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PointLight</span> &#123;</span></span><br><span class="line">    vec3 position;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> constant;</span><br><span class="line">    <span class="keyword">float</span> linear;</span><br><span class="line">    <span class="keyword">float</span> quadratic;</span><br><span class="line"></span><br><span class="line">    vec3 ambient;</span><br><span class="line">    vec3 diffuse;</span><br><span class="line">    vec3 specular;</span><br><span class="line">&#125;;  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NR_POINT_LIGHTS 4</span></span><br><span class="line">uniform PointLight pointLights[NR_POINT_LIGHTS];</span><br></pre></td></tr></table></figure></p>
<p>点光源函数的原型如下：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">vec3 <span class="title">CalcPointLight</span><span class="params">(PointLight light, vec3 normal, vec3 fragPos, vec3 viewDir)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这个函数从参数中获取所需的所有数据，并返回一个代表该点光源对片段的颜色贡献的vec3.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">vec3 <span class="title">CalcPointLight</span><span class="params">(PointLight light, vec3 normal, vec3 fragPos, vec3 viewDir)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vec3 lightDir = normalize(light.position - fragPos);</span><br><span class="line">    <span class="comment">// 漫反射着色</span></span><br><span class="line">    <span class="keyword">float</span> diff = max(dot(normal, lightDir), <span class="number">0.0</span>);</span><br><span class="line">    <span class="comment">// 镜面光着色</span></span><br><span class="line">    vec3 reflectDir = reflect(-lightDir, normal);</span><br><span class="line">    <span class="keyword">float</span> spec = <span class="built_in">pow</span>(max(dot(viewDir, reflectDir), <span class="number">0.0</span>), material.shininess);</span><br><span class="line">    <span class="comment">// 衰减</span></span><br><span class="line">    <span class="keyword">float</span> distance    = length(light.position - fragPos);</span><br><span class="line">    <span class="keyword">float</span> attenuation = <span class="number">1.0</span> / (light.constant + light.linear * distance + </span><br><span class="line">                 light.quadratic * (distance * distance));    </span><br><span class="line">    <span class="comment">// 合并结果</span></span><br><span class="line">    vec3 ambient  = light.ambient  * vec3(texture(material.diffuse, TexCoords));</span><br><span class="line">    vec3 diffuse  = light.diffuse  * diff * vec3(texture(material.diffuse, TexCoords));</span><br><span class="line">    vec3 specular = light.specular * spec * vec3(texture(material.specular, TexCoords));</span><br><span class="line">    ambient  *= attenuation;</span><br><span class="line">    diffuse  *= attenuation;</span><br><span class="line">    specular *= attenuation;</span><br><span class="line">    <span class="keyword">return</span> (ambient + diffuse + specular);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在main函数中，我们只需要创建一个循环，遍历整个点光源数组，对每个点光源调用CalcPointLight就可以了.</p>
<h2 id="合并结果"><a href="#合并结果" class="headerlink" title="合并结果"></a>合并结果</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 属性</span></span><br><span class="line">    vec3 norm = normalize(Normal);</span><br><span class="line">    vec3 viewDir = normalize(viewPos - FragPos);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一阶段：定向光照</span></span><br><span class="line">    vec3 result = CalcDirLight(dirLight, norm, viewDir);</span><br><span class="line">    <span class="comment">// 第二阶段：点光源</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NR_POINT_LIGHTS; i++)</span><br><span class="line">        result += CalcPointLight(pointLights[i], norm, FragPos, viewDir);    </span><br><span class="line">    <span class="comment">// 第三阶段：聚光</span></span><br><span class="line">    <span class="comment">//result += CalcSpotLight(spotLight, norm, FragPos, viewDir);    </span></span><br><span class="line"></span><br><span class="line">    FragColor = vec4(result, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>设置一个<strong>结构体数组</strong>的uniform和设置一个<strong>结构体</strong>的uniform是很相似的，但是这一次在访问uniform位置的时候，我们需要定义对应的数组下标值：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">lightingShader.setFloat(<span class="string">"pointLights[0].constant"</span>, <span class="number">1.0f</span>);</span><br></pre></td></tr></table></figure>
<p>我们会定义另一个glm::vec3数组来包含点光源的位置：<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">glm::vec3 pointLightPositions[] = &#123;</span><br><span class="line">    glm::vec3( <span class="number">0.7f</span>,  <span class="number">0.2f</span>,  <span class="number">2.0f</span>),</span><br><span class="line">    glm::vec3( <span class="number">2.3f</span>, <span class="number">-3.3f</span>, <span class="number">-4.0f</span>),</span><br><span class="line">    glm::vec3(<span class="number">-4.0f</span>,  <span class="number">2.0f</span>, <span class="number">-12.0f</span>),</span><br><span class="line">    glm::vec3( <span class="number">0.0f</span>,  <span class="number">0.0f</span>, <span class="number">-3.0f</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>接下来我们从pointLights数组中索引对应的PointLight，将它的position值设置为刚刚定义的位置值数组中的其中一个.同时我们还要保证现在绘制的是四个灯立方体而不是仅仅一个.只要对每个灯物体创建一个不同的模型矩阵就可以了，和我们之前对箱子的处理类似.</p>
<p>如果你还使用了手电筒的话，所有光源组合的效果将看起来和下图差不多：<br><img src="https://img-blog.csdnimg.cn/20190923213001831.png" alt="在这里插入图片描述"></p>

        </div>
        <!-- .entry-content -->
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2019/10/07/LearnOpenGL-模型加载/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/3.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/3.png">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                LearnOpenGL-模型加载</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2019/10/07/LearnOpenGL-入门/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/2.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/cover/2.png">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                LearnOpenGL-入门</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "wswNvhpWzQ3DPNl7W2e9u6TW-gzGzoHsz",
        appKey: "CVFjJULlnSe9RxKSEngIk5aR",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <a href="www.shiroha.cn" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/custom/avatar.jpg" itemprop="image" alt="Shiroha" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="www.shiroha.cn" itemprop="url" rel="author">Shiroha</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>Shiroha</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Shiroha<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1","name":"summer.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1","name":"summer.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/hagase/shiroha_cdn@1.1/img/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">Shirohaの小矛屋</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/hagase" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://weibo.com/5641766727/profile" class="fa fa-weibo" target="_blank" style="color: #dd4b39; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/技术/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/生活/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  生活
                </a>
              </li>
            
              <li>
                <a href="/categories/随想/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  随想
                </a>
              </li>
            
              <li>
                <a href="/categories/转载/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  转载
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/悦读/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  书单
                </a>
              </li>
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  番组
                </a>
              </li>
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
              <li>
                <a href="/tags/图集/">
                  <i class="fa fa-photo" aria-hidden="true"></i>
                  图集
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
              <li>
                <a href="/theme-sakura/">
                  <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                  主题
                </a>
              </li>
            
              <li>
                <a href="/lab/">
                  <i class="fa fa-cogs" aria-hidden="true"></i>
                  Lab
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<div class="aplayer"

    data-id="311465842"

    data-server="netease"

    data-type="playlist"

    data-fixed="true"

    data-autoplay="false"

    data-loop="all"

    data-order="random"

    data-preload="auto"

    data-volume="0.7"

    data-mutex="true"

</div>
<script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>